# vue

- 使用Rollup搭建开发环境
  - 什么是Rollup?
  - 环境搭建
- Vue响应式原理
  - 初始化数据
  - 递归属性劫持
  - 数组方法的劫持
  - 数据代理
- 模板编译
  - 解析标签和内容
  - 生成ast语法树
  - 生成代码
  - 生成render函数
- 创建渲染watcher
  - 初始化渲染Watcher
  - 生成虚拟dom
  - 生成真实DOM元素
- 生命周期的合并
  - Mixin原理
  - 合并生命周期
  - 调用声明周期
  - 初始化流程中调用声明周期
- 依赖收集
  - 在渲染时存储watcher
  - 对象依赖收集
  - 数组的依赖收集
- 实现Vue异步更新之nextTick
  - 实现队列机制
  - nextTick实现原理

## 使用Rollup搭建开发环境

### 什么是Rollup?

Rollup 是一个 JavaScript 模块打包器，可以将小块代码编译成大块复杂的代码，rollup.js更专注于Javascript类库打包（开发应用时使用Webpack，开发库时使用Rollup）

### 环境搭建

初始化项目`npm init -y`

安装rollup环境

```
npm install rollup rollup-plugin-babel @babel/core @babel/preset-env rollup-plugin-serve cross-env -D
```

- rollup-plugin-babel，rollup与babel的桥梁
- @babel/core，babel核心模块
- @babel/preset-env，预设，babel插件集合，将高级语法转成低级语法
- rollup-plugin-serve ，启动本地服务，实现静态服务
- cross-env，设置环境变量

rollup.config.js编写

```js
import babel from 'rollup-plugin-babel'
import serve from 'rollup-plugin-serve'

export default {
    input: './src/index.js', // 打包入口
    output: {
        file: 'dist/umd/vue.js', // 出口路径
        name: 'Vue', // 指定打包后全局变量的名字
        format: 'umd', // 统一模块化规范 模块化的类型 esModule commonjs模块
        sourcemap: true // es6 -> es5 开启源码调试 可以找到源代码的报错位置
    },
    plugins: [
        babel({
            exclude: 'node_modules/**'
        }),
        process.env.ENV === 'development' ? serve({
            port: 3000, // 打开的浏览器，端口是3000端口
            contentBase: '', // ''表示当前目录
            openPage: '/index.html' // 默认打开html的路径
        }) : null
    ]
}
```

配置babel，.babelrc

```shell
{
    "presets": [
        "@babel/preset-env"
    ]
}
```

配置启动脚本，package.json

```js
"scripts": {
    "build:dev": "rollup -c", // -c 使用配置文件
    "serve": "cross-env ENV=development rollup -c -w" // -w监听代码变化自动打包
  },
```
创建一个空Vue，src/index.js
```index.js
function Vue(options){
    console.log(options)
}
export default Vue
```

## Vue响应式原理

### 初始化数据

